# Dependabot PR ìë™ ë³‘í•© ì›Œí¬í”Œë¡œìš°
# Dependabotì´ ìƒì„±í•œ PRì„ íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë³‘í•©í•©ë‹ˆë‹¤.
name: Auto-merge Dependabot PRs

# íŠ¸ë¦¬ê±° ì¡°ê±´: PRì´ ì—´ë¦¬ê±°ë‚˜ ì—…ë°ì´íŠ¸ë  ë•Œ ì‹¤í–‰
# pull_request_targetì„ ì‚¬ìš©í•˜ì—¬ forked repoì—ì„œë„ ì•ˆì „í•˜ê²Œ ì‹¤í–‰
on:
  pull_request_target:
    types: [opened, synchronize]

# ì›Œí¬í”Œë¡œìš°ì— í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: write        # ì½”ë“œ ë³‘í•©ì„ ìœ„í•œ ê¶Œí•œ
  pull-requests: write   # PR ì¡°ì‘ì„ ìœ„í•œ ê¶Œí•œ

jobs:
  dependabot:
    runs-on: ubuntu-latest
    # Dependabotì´ ìƒì„±í•œ PRì—ì„œë§Œ ì‹¤í–‰
    if: github.actor == 'dependabot[bot]'
    steps:
      # Dependabot PRì˜ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘ (ì—…ë°ì´íŠ¸ íƒ€ì…, ì˜ì¡´ì„± ì¢…ë¥˜ ë“±)
      - name: Dependabot metadata
        id: metadata
        uses: dependabot/fetch-metadata@v2
        with:
          github-token: "${{ secrets.GITHUB_TOKEN }}"

      # ê°œë°œ ì˜ì¡´ì„±ì˜ ëª¨ë“  ì—…ë°ì´íŠ¸ ìë™ ë³‘í•© (squash merge ì‚¬ìš©)
      # ê°œë°œ ì˜ì¡´ì„±ì€ í”„ë¡œë•ì…˜ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë¯€ë¡œ ëª¨ë“  ì—…ë°ì´íŠ¸ í—ˆìš©
      - name: Auto-merge for all updates in dev dependencies
        if: steps.metadata.outputs.dependency-type == 'direct:development'
        run: gh pr merge --auto --squash "$PR_URL"
        env:
          PR_URL: ${{github.event.pull_request.html_url}}
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}

      # í”„ë¡œë•ì…˜ ì˜ì¡´ì„±ì˜ íŒ¨ì¹˜ ì—…ë°ì´íŠ¸ë§Œ ìë™ ë³‘í•© (squash merge ì‚¬ìš©)
      # ì˜ˆ: 1.2.3 â†’ 1.2.4 (ë²„ê·¸ ìˆ˜ì •, ë³´ì•ˆ íŒ¨ì¹˜ ë“± - ì•ˆì „í•¨)
      - name: Auto-merge for patch updates in production dependencies
        if: |
          steps.metadata.outputs.update-type == 'version-update:semver-patch' &&
          steps.metadata.outputs.dependency-type == 'direct:production'
        run: gh pr merge --auto --squash "$PR_URL"
        env:
          PR_URL: ${{github.event.pull_request.html_url}}
          GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}

# âš ï¸ ì£¼ì˜ì‚¬í•­:
# 1. í”„ë¡œë•ì…˜ ì˜ì¡´ì„±ì˜ ë©”ì´ì €/ë§ˆì´ë„ˆ ì—…ë°ì´íŠ¸ëŠ” ìˆ˜ë™ ê²€í†  ê¶Œì¥
# 2. Branch protection rules ì„¤ì • ì‹œ CI í†µê³¼ í›„ì—ë§Œ ìë™ ë³‘í•©ë¨
# 3. --auto --squash í”Œë˜ê·¸ë¡œ squash merge ë°©ì‹ ì‚¬ìš©í•˜ì—¬ ì»¤ë°‹ íˆìŠ¤í† ë¦¬ ì •ë¦¬

# ğŸ’¡ ìë™ ë³‘í•© ì¡°ê±´:
# âœ… ê°œë°œ ì˜ì¡´ì„± (devDependencies): ëª¨ë“  ì—…ë°ì´íŠ¸ (patch/minor/major) ìë™ ë³‘í•©
# âœ… í”„ë¡œë•ì…˜ ì˜ì¡´ì„± (dependencies): íŒ¨ì¹˜ ì—…ë°ì´íŠ¸ë§Œ ìë™ ë³‘í•© (x.x.1 â†’ x.x.2)
# âŒ í”„ë¡œë•ì…˜ ì˜ì¡´ì„± ë§ˆì´ë„ˆ/ë©”ì´ì € ì—…ë°ì´íŠ¸: ìˆ˜ë™ ê²€í†  í•„ìš”
